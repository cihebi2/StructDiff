# StructDiff-7.0.0 ä¸‹ä¸€é˜¶æ®µè®­ç»ƒè®¡åˆ’

## ğŸ“Š å½“å‰çŠ¶æ€æ€»ç»“

### âœ… å·²ä¿®å¤çš„å…³é”®é—®é¢˜
1. **CUDAå†…å­˜ä¸è¶³** - ç¦ç”¨åŠ¨æ€ESMFoldåŠ è½½ï¼Œä½¿ç”¨é¢„è®¡ç®—ç¼“å­˜
2. **ç¼“å­˜æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´** - ç»Ÿä¸€MD5å“ˆå¸Œå‘½åå’Œç›®å½•ç»“æ„
3. **EMAå±æ€§é”™è¯¯** - ä¿®å¤`AttributeError: 'EMA' object has no attribute 'ema_model'`
4. **ç»“æ„ç‰¹å¾å½¢çŠ¶ä¸åŒ¹é…** - æ·»åŠ åŠ¨æ€å¡«å……é€»è¾‘
5. **DataLoader CUDAå¼ é‡é—®é¢˜** - å¼ºåˆ¶CPUå¼ é‡pin_memory
6. **masked_fillç±»å‹é”™è¯¯** - è½¬æ¢Longç±»å‹ä¸ºBoolç±»å‹
7. **æ£€æŸ¥ç‚¹ä¿å­˜TypeError** - ä¿®å¤å‚æ•°ä¼ é€’é—®é¢˜

### ğŸ” å½“å‰é…ç½®åˆ†æ
- **é…ç½®æ–‡ä»¶**: `configs/separated_training_production.yaml`
- **ç»“æ„ç‰¹å¾**: å½“å‰ `use_esmfold: false`ï¼ˆå·²ç¦ç”¨ï¼‰
- **é¢„è®¡ç®—ç¼“å­˜**: å·²å¯ç”¨ `use_predicted_structures: true`
- **è®­ç»ƒé˜¶æ®µ**: å·²å®Œæˆv1å’Œv2_no_esmfoldç‰ˆæœ¬

## ğŸ¯ æ¨èè¡ŒåŠ¨æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šå¯ç”¨ç»“æ„ç‰¹å¾çš„å®Œæ•´è®­ç»ƒï¼ˆå¼ºçƒˆæ¨èï¼‰

**ç›®æ ‡**: å¯ç”¨ESMFoldç»“æ„ç‰¹å¾ï¼ŒéªŒè¯ç»“æ„æ„ŸçŸ¥è®­ç»ƒçš„æ•ˆæœ

**é…ç½®ä¿®æ”¹**:
```yaml
# éœ€è¦ä¿®æ”¹çš„å…³é”®é…ç½®
model:
  structure_encoder:
    use_esmfold: true      # ä»falseæ”¹ä¸ºtrue
    use_cache: true        # ç¡®ä¿ä½¿ç”¨é¢„è®¡ç®—ç¼“å­˜
    
data:
  use_predicted_structures: true   # ç¡®ä¿å¯ç”¨
  structure_cache_dir: "./structure_cache"  # ä½¿ç”¨æ­£ç¡®çš„ç¼“å­˜ç›®å½•
```

### æ–¹æ¡ˆBï¼šä¼˜åŒ–ç°æœ‰æ— ç»“æ„ç‰¹å¾è®­ç»ƒ

**ç›®æ ‡**: åœ¨å½“å‰é…ç½®åŸºç¡€ä¸Šè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½

**ä¼˜åŒ–å‚æ•°**:
- å¢åŠ æ‰¹æ¬¡å¤§å°ï¼ˆä»2â†’4æˆ–8ï¼‰
- è°ƒæ•´å­¦ä¹ ç‡
- å¯ç”¨æ›´å¤šGPUå¹¶è¡Œè®­ç»ƒ

## ğŸš€ å…·ä½“æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šéªŒè¯é¢„è®¡ç®—ç¼“å­˜
```bash
# æ£€æŸ¥ç»“æ„ç¼“å­˜æ˜¯å¦å­˜åœ¨
ls -la sequence/StructDiff-7.0.0/structure_cache/
ls -la sequence/StructDiff-7.0.0/cache/
```

### æ­¥éª¤2ï¼šåˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶
åˆ›å»º `configs/separated_training_structure_enabled.yaml`:
- å¯ç”¨ `use_esmfold: true`
- ä¿æŒæ‰¹æ¬¡å¤§å°ä¸º2ï¼ˆé¿å…å†…å­˜é—®é¢˜ï¼‰
- ä½¿ç”¨é¢„è®¡ç®—ç¼“å­˜

### æ­¥éª¤3ï¼šå¯åŠ¨æ–°çš„è®­ç»ƒ
```bash
# é˜¶æ®µ1è®­ç»ƒï¼ˆå¯ç”¨ç»“æ„ç‰¹å¾ï¼‰
python scripts/train_separated.py \
  --config configs/separated_training_structure_enabled.yaml \
  --output-dir ./outputs/separated_structure_v1 \
  --stage 1 \
  --batch-size 2 \
  --stage1-lr 1e-4 \
  --use-amp --use-ema --use-cfg --use-length-control

# é˜¶æ®µ2è®­ç»ƒ
python scripts/train_separated.py \
  --config configs/separated_training_structure_enabled.yaml \
  --output-dir ./outputs/separated_structure_v1 \
  --stage 2 \
  --stage1-checkpoint ./outputs/separated_structure_v1/checkpoints/latest.pth \
  --batch-size 8 \
  --stage2-lr 5e-5 \
  --use-amp --use-ema --use-cfg --use-length-control
```

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### è®­ç»ƒç›‘æ§
- **é˜¶æ®µ1æŸå¤±**: å»å™ªå™¨MSEæŸå¤±
- **é˜¶æ®µ2æŸå¤±**: åºåˆ—é‡å»ºäº¤å‰ç†µæŸå¤±
- **éªŒè¯æŸå¤±**: æ¯ä¸ªepochçš„éªŒè¯é›†è¡¨ç°
- **GPUåˆ©ç”¨ç‡**: å®æ—¶ç›‘æ§æ˜¾å­˜ä½¿ç”¨

### è¯„ä¼°æŒ‡æ ‡
- **ä¼ªå›°æƒ‘åº¦**: ESM-2è¯„ä¼°çš„åºåˆ—è´¨é‡
- **ç»“æ„åˆç†æ€§**: é¢„æµ‹ç»“æ„çš„plDDTåˆ†æ•°
- **æ–°é¢–æ€§æ¯”ä¾‹**: ä¸è®­ç»ƒé›†çš„å·®å¼‚åº¦
- **æ´»æ€§é¢„æµ‹**: æŠ—èŒè‚½æ´»æ€§é¢„æµ‹åˆ†æ•°

## âš ï¸ é£é™©æç¤º

### å†…å­˜ç®¡ç†
- **æ‰¹æ¬¡å¤§å°**: ä¿æŒè¾ƒå°æ‰¹æ¬¡ï¼ˆ2-4ï¼‰é¿å…OOM
- **æ¢¯åº¦ç´¯ç§¯**: ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯è¾¾åˆ°æœ‰æ•ˆæ‰¹æ¬¡å¤§å°
- **æ··åˆç²¾åº¦**: å¯ç”¨AMPå‡å°‘å†…å­˜ä½¿ç”¨

### ç¼“å­˜éªŒè¯
- **ç¼“å­˜å®Œæ•´æ€§**: ç¡®ä¿æ‰€æœ‰è®­ç»ƒæ ·æœ¬éƒ½æœ‰é¢„è®¡ç®—ç»“æ„
- **ç¼“å­˜è·¯å¾„**: éªŒè¯ç¼“å­˜ç›®å½•æƒé™å’Œå¯ç”¨ç©ºé—´

## ğŸ”„ å¤‡é€‰æ–¹æ¡ˆ

å¦‚æœç»“æ„ç‰¹å¾è®­ç»ƒé‡åˆ°é—®é¢˜ï¼š

1. **å›é€€åˆ°æ— ç»“æ„ç‰¹å¾**: ä½¿ç”¨ç°æœ‰v2_no_esmfoldé…ç½®
2. **æ··åˆè®­ç»ƒ**: å…ˆæ— ç»“æ„ç‰¹å¾ï¼Œåå¾®è°ƒæ·»åŠ ç»“æ„ç‰¹å¾
3. **åˆ†é˜¶æ®µå¯ç”¨**: é€æ­¥å¢åŠ ç»“æ„ç‰¹å¾çš„æƒé‡

## ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨æ¸…å•

- [ ] ç¡®è®¤é¢„è®¡ç®—ç¼“å­˜å®Œæ•´æ€§
- [ ] åˆ›å»ºç»“æ„æ„ŸçŸ¥é…ç½®æ–‡ä»¶
- [ ] å¯åŠ¨é˜¶æ®µ1è®­ç»ƒï¼ˆç»“æ„æ„ŸçŸ¥ï¼‰
- [ ] ç›‘æ§è®­ç»ƒè¿‡ç¨‹
- [ ] è¯„ä¼°ç»“æ„ç‰¹å¾æ•ˆæœ
- [ ] å¯¹æ¯”æœ‰æ— ç»“æ„ç‰¹å¾çš„æ€§èƒ½å·®å¼‚

## ğŸ¯ å†³ç­–å»ºè®®

**æ¨èç«‹å³æ‰§è¡Œ**: å¯ç”¨ç»“æ„ç‰¹å¾çš„å®Œæ•´è®­ç»ƒ
**ç†ç”±**: 
1. æ‰€æœ‰å…³é”®æŠ€æœ¯é—®é¢˜å·²ä¿®å¤
2. é¢„è®¡ç®—ç¼“å­˜æœºåˆ¶å·²éªŒè¯
3. ç»“æ„ç‰¹å¾å¯èƒ½æ˜¾è‘—æå‡æ¨¡å‹æ€§èƒ½
4. å½“å‰ç¡¬ä»¶é…ç½®æ”¯æŒç»“æ„æ„ŸçŸ¥è®­ç»ƒ

**é¢„æœŸæ”¶ç›Š**: 
- æ›´å¥½çš„ç»“æ„-åºåˆ—ä¸€è‡´æ€§
- æ›´é«˜çš„ç”Ÿç‰©æ´»æ€§é¢„æµ‹å‡†ç¡®æ€§
- æ›´åˆç†çš„è‚½æ®µç»“æ„è®¾è®¡