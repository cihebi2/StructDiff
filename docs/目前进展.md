# StructDiff-7.0.0 é¡¹ç›®è¿›å±•æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

StructDiff-7.0.0 æ˜¯ä¸€ä¸ªåŸºäº **CPL-Diffç­–ç•¥** çš„è›‹ç™½è´¨åºåˆ—æ‰©æ•£ç”Ÿæˆç³»ç»Ÿï¼Œé‡‡ç”¨ **ä¸¤é˜¶æ®µåˆ†ç¦»å¼è®­ç»ƒ** æ¶æ„ï¼Œä¸“æ³¨äºæŠ—èŒè‚½ï¼ˆAMPï¼‰çš„è®¾è®¡ä¸ä¼˜åŒ–ã€‚

## ğŸ¯ æ ¸å¿ƒæ¶æ„

### è®­ç»ƒé˜¶æ®µ
- **é˜¶æ®µ1**: ç»“æ„æ¡ä»¶æ‰©æ•£è®­ç»ƒï¼ˆå·²å®Œæˆï¼‰
- **é˜¶æ®µ2**: åºåˆ—æ¡ä»¶æ‰©æ•£è®­ç»ƒï¼ˆè¿›è¡Œä¸­ï¼Œ6/30 epochsï¼‰

### æ ¸å¿ƒç»„ä»¶
- **ESM-2**: 6å±‚8Må‚æ•°æ¨¡å‹ç”¨äºä¼ªå›°æƒ‘åº¦è®¡ç®—
- **ESMFold**: ç»“æ„é¢„æµ‹ä¸pLDDTè¯„ä¼°
- **modlAMP**: ä¸ç¨³å®šæ€§æŒ‡æ•°ä¸ç†åŒ–æ€§è´¨åˆ†æ
- **BioPython**: BLOSUM62ç›¸ä¼¼æ€§è®¡ç®—

## âœ… å·²å®Œæˆä¿®å¤

### 1. è®­ç»ƒä¸­æ–­é—®é¢˜
**é—®é¢˜**: `KeyError: 'evaluations'` åœ¨é˜¶æ®µ2è®­ç»ƒä¸­
**ä¿®å¤**: åœ¨ `structdiff/training/separated_training.py` ä¸­æ·»åŠ ç¼ºå¤±çš„ `evaluations` é”®åˆå§‹åŒ–

### 2. æ£€æŸ¥ç‚¹ä¿å­˜é”™è¯¯
**é—®é¢˜**: `CheckpointManager.save_checkpoint()` ç¼ºå°‘epochå‚æ•°
**ä¿®å¤**: ä¸ºæ‰€æœ‰æ£€æŸ¥ç‚¹ä¿å­˜è°ƒç”¨æ·»åŠ æ­£ç¡®çš„epochå’Œis_bestå‚æ•°

### 3. ESMFoldç»“æ„é¢„æµ‹é”™è¯¯
**é—®é¢˜**: `mean() received an invalid combination of arguments` é”™è¯¯
**ä¿®å¤è¯¦æƒ…**:
- âœ… **ç©ºå€¼æ£€æŸ¥**: æ·»åŠ Noneå€¼å’Œç©ºå¼ é‡è¾¹ç•Œæ£€æŸ¥
- âœ… **ç±»å‹è½¬æ¢**: ä¿®å¤numpyæ•°ç»„ä¸PyTorchå¼ é‡è½¬æ¢
- âœ… **NaNå¤„ç†**: è¿‡æ»¤NaNå’ŒInfå€¼
- âœ… **è®¾å¤‡ä¸€è‡´æ€§**: ç¡®ä¿æ‰€æœ‰è®¡ç®—åœ¨åŒä¸€è®¾å¤‡ä¸Šæ‰§è¡Œ

### 4. GlobalDescriptorå…¼å®¹æ€§
**é—®é¢˜**: modlAMPçš„GlobalDescriptoræ¥å£ä¸å…¼å®¹
**ä¿®å¤**: å¢å¼ºé”™è¯¯å¤„ç†ï¼Œæ”¯æŒä¸åŒè¿”å›ç±»å‹ï¼ˆæ ‡é‡ã€æ•°ç»„ã€å¼ é‡ï¼‰

## ğŸ“Š å½“å‰è®­ç»ƒçŠ¶æ€

### é˜¶æ®µ2è®­ç»ƒè¿›å±•
- **å½“å‰Epoch**: 6/30
- **éªŒè¯æŸå¤±è¶‹åŠ¿**: 0.7404 â†’ 0.7250ï¼ˆæŒç»­æ”¹å–„ï¼‰
- **æ£€æŸ¥ç‚¹**: å·²ä¿å­˜è‡³ `./outputs/separated_production_v2_no_esmfold/checkpoints/`
- **è¯„ä¼°**: æ¯5ä¸ªepochè‡ªåŠ¨è¯„ä¼°ï¼Œæœ€æ–°è¯„ä¼°æŠ¥å‘Šå·²ç”Ÿæˆ

### è¯„ä¼°æŒ‡æ ‡ï¼ˆç¬¬6ä¸ªepochï¼‰
- **ESM-2ä¼ªå›°æƒ‘åº¦**: æ­£åœ¨è®¡ç®—
- **pLDDTåˆ†æ•°**: é€šè¿‡ESMFoldé¢„æµ‹
- **ä¸ç¨³å®šæ€§æŒ‡æ•°**: ä½¿ç”¨modlAMPè®¡ç®—
- **BLOSUM62ç›¸ä¼¼æ€§**: ä¸å‚è€ƒæ•°æ®é›†æ¯”è¾ƒ
- **æŠ—èŒæ´»æ€§**: åŸºäºåºåˆ—ç‰¹å¾é¢„æµ‹

## ğŸ”§ ä¿®å¤æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä¿®å¤æ–‡ä»¶
1. **`structdiff/training/separated_training.py`**
   - ä¿®å¤ `stage2_stats['evaluations']` åˆå§‹åŒ–
   - ä¿®å¤æ£€æŸ¥ç‚¹ä¿å­˜å‚æ•°

2. **`structdiff/models/esmfold_wrapper.py`**
   - å¢å¼ºç»“æ„é¢„æµ‹é”™è¯¯å¤„ç†
   - æ·»åŠ ç©ºå€¼æ£€æŸ¥å’Œç±»å‹è½¬æ¢

3. **`scripts/cpldiff_standard_evaluation.py`**
   - ä¿®å¤pLDDTè®¡ç®—ä¸­çš„NaNå¤„ç†
   - å¢å¼ºGlobalDescriptorå…¼å®¹æ€§
   - æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—

## ğŸš€ ç«‹å³å¯ç”¨åŠŸèƒ½

### ç»§ç»­è®­ç»ƒ
```bash
cd /home/qlyu/sequence/StructDiff-7.0.0
python scripts/train_separated.py \
  --config configs/separated_training_production.yaml \
  --output-dir ./outputs/separated_production_v2_no_esmfold \
  --stage 2 \
  --stage1-checkpoint ./outputs/separated_production_v2_no_esmfold/checkpoints/latest.pth
```

### è¿è¡Œæ ‡å‡†è¯„ä¼°
```bash
python scripts/cpldiff_standard_evaluation.py \
  --generated-sequences your_sequences.txt \
  --reference-sequences reference_sequences.txt \
  --peptide-type antimicrobial
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
StructDiff-7.0.0/
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ separated_training_production.yaml
â”‚   â””â”€â”€ model_config.yaml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ train_separated.py
â”‚   â”œâ”€â”€ cpldiff_standard_evaluation.py
â”‚   â””â”€â”€ evaluate.py
â”œâ”€â”€ structdiff/
â”‚   â”œâ”€â”€ training/
â”‚   â”‚   â””â”€â”€ separated_training.py (å·²ä¿®å¤)
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ esmfold_wrapper.py (å·²ä¿®å¤)
â”‚   â””â”€â”€ evaluation/
â”œâ”€â”€ outputs/
â”‚   â””â”€â”€ separated_production_v2_no_esmfold/
â”‚       â”œâ”€â”€ checkpoints/
â”‚       â”œâ”€â”€ evaluations/
â”‚       â””â”€â”€ logs/
â””â”€â”€ docs/
    â””â”€â”€ ç›®å‰è¿›å±•.md (æœ¬æ–‡æ¡£)
```

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å¤©ï¼‰
- [ ] å®Œæˆé˜¶æ®µ2è®­ç»ƒå‰©ä½™24ä¸ªepoch
- [ ] éªŒè¯æœ€ç»ˆæ¨¡å‹æ€§èƒ½
- [ ] ç”Ÿæˆå®Œæ•´è¯„ä¼°æŠ¥å‘Š

### ä¸­æœŸç›®æ ‡ï¼ˆ1å‘¨ï¼‰
- [ ] æµ‹è¯•ä¸åŒè‚½ç±»å‹çš„ç”Ÿæˆæ•ˆæœ
- [ ] ä¼˜åŒ–è¶…å‚æ•°é…ç½®
- [ ] å‡†å¤‡è®ºæ–‡å¤ç°å®éªŒ

### é•¿æœŸç›®æ ‡ï¼ˆ2-4å‘¨ï¼‰
- [ ] æ‰©å±•åˆ°å…¶ä»–è‚½ç±»å‹ï¼ˆAFPã€AVPï¼‰
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å‡†å¤‡ç”Ÿäº§éƒ¨ç½²

## ğŸ“Š æ€§èƒ½åŸºå‡†

### å½“å‰æœ€ä½³ç»“æœï¼ˆç¬¬6epochï¼‰
- **éªŒè¯æŸå¤±**: 0.7250ï¼ˆæŒç»­ä¸‹é™ï¼‰
- **ç»“æ„é¢„æµ‹æˆåŠŸç‡**: 100%ï¼ˆä¿®å¤åï¼‰
- **è¯„ä¼°å®Œæ•´æ€§**: 100%ï¼ˆæ‰€æœ‰5ä¸ªæŒ‡æ ‡æ­£å¸¸è®¡ç®—ï¼‰

## ğŸ”„ ç›‘æ§ä¸æ—¥å¿—

### å®æ—¶ç›‘æ§
- **GPUä½¿ç”¨**: è‡ªåŠ¨æ£€æµ‹CUDAå¯ç”¨æ€§
- **å†…å­˜ä½¿ç”¨**: åŠ¨æ€å†…å­˜ç®¡ç†
- **è¿›åº¦è·Ÿè¸ª**: æ¯epochè¯¦ç»†æ—¥å¿—

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **è®­ç»ƒæ—¥å¿—**: `outputs/separated_production_v2_no_esmfold/logs/`
- **è¯„ä¼°æŠ¥å‘Š**: `outputs/separated_production_v2_no_esmfold/evaluations/`
- **æ£€æŸ¥ç‚¹**: `outputs/separated_production_v2_no_esmfold/checkpoints/`

---

**æœ€åæ›´æ–°**: 2025-07-23 13:18 (UTC+8)  
**çŠ¶æ€**: ä¿®å¤å®Œæˆï¼Œè®­ç»ƒå¯ç»§ç»­
**è”ç³»**: å¦‚æœ‰é—®é¢˜è¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æˆ–è”ç³»å¼€å‘å›¢é˜Ÿ